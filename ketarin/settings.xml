<?xml version="1.0" encoding="utf-8"?>
<Ketarin>
  <Settings>
    <dictionary>
      <item>
        <key>
          <string>AuthorGuid</string>
        </key>
        <value>
          <string>System.String:{75a093b7-da5f-493a-b8f0-22c278f874c1}</string>
        </value>
      </item>
      <item>
        <key>
          <string>LastUpdateCheck</string>
        </key>
        <value>
          <string>AAEAAAD/////AQAAAAAAAAAEAQAAAA9TeXN0ZW0uRGF0ZVRpbWUCAAAABXRpY2tzCGRhdGVEYXRhAAAJELX8zVy9fdIItfzNXL190ogL</string>
        </value>
      </item>
      <item>
        <key>
          <string>PreUpdateCommand</string>
        </key>
        <value>
          <string>System.String:chocopkgup {nopush} --packagename={appname} --version={version} --pg="{packageGuid}" --url="{preupdate-url}" --urlx64="{url64}" --packagepath="{file}" --checksum="{checksum}" --c64="{checksumx64}" --debug</string>
        </value>
      </item>
      <item>
        <key>
          <string>PreUpdateCommandType</string>
        </key>
        <value>
          <string>System.String:Batch</string>
        </value>
      </item>
      <item>
        <key>
          <string>CustomColumns</string>
        </key>
        <value>
          <string>System.String:&lt;?xml version="1.0" encoding="utf-16"?&gt;
&lt;dictionary&gt;
  &lt;item&gt;
    &lt;key&gt;
      &lt;string&gt;Version&lt;/string&gt;
    &lt;/key&gt;
    &lt;value&gt;
      &lt;string&gt;{version}&lt;/string&gt;
    &lt;/value&gt;
  &lt;/item&gt;
  &lt;item&gt;
    &lt;key&gt;
      &lt;string&gt;Filesize&lt;/string&gt;
    &lt;/key&gt;
    &lt;value&gt;
      &lt;string&gt;{filesize:formatfilesize}&lt;/string&gt;
    &lt;/value&gt;
  &lt;/item&gt;
  &lt;item&gt;
    &lt;key&gt;
      &lt;string&gt;host&lt;/string&gt;
    &lt;/key&gt;
    &lt;value&gt;
      &lt;string&gt;{url:regex:(?&amp;lt;=//).*?(?=/)}&lt;/string&gt;
    &lt;/value&gt;
  &lt;/item&gt;
  &lt;item&gt;
    &lt;key&gt;
      &lt;string&gt;packageGuid&lt;/string&gt;
    &lt;/key&gt;
    &lt;value&gt;
      &lt;string&gt;{packageGuid}&lt;/string&gt;
    &lt;/value&gt;
  &lt;/item&gt;
  &lt;item&gt;
    &lt;key&gt;
      &lt;string&gt;fileDate&lt;/string&gt;
    &lt;/key&gt;
    &lt;value&gt;
      &lt;string&gt;{f:yyyy}.{f:MM}.{f:dd} {f:HH}{f:mm}&lt;/string&gt;
    &lt;/value&gt;
  &lt;/item&gt;
&lt;/dictionary&gt;</string>
        </value>
      </item>
      <item>
        <key>
          <string>CustomColumn</string>
        </key>
        <value>
          <string p6:nil="true" xmlns:p6="http://www.w3.org/2001/XMLSchema-instance" />
        </value>
      </item>
      <item>
        <key>
          <string>CustomColumn2</string>
        </key>
        <value>
          <string p6:nil="true" xmlns:p6="http://www.w3.org/2001/XMLSchema-instance" />
        </value>
      </item>
      <item>
        <key>
          <string>UpdateAtStartup</string>
        </key>
        <value>
          <string>System.Boolean:False</string>
        </value>
      </item>
      <item>
        <key>
          <string>AvoidFileHippoBeta</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>ConnectionTimeout</string>
        </key>
        <value>
          <string>AAEAAAD/////AQAAAAAAAAAEAQAAAA5TeXN0ZW0uRGVjaW1hbAQAAAAFZmxhZ3MCaGkCbG8DbWlkAAAAAAgICAgAAAAAAAAAADwAAAAAAAAACw==</string>
        </value>
      </item>
      <item>
        <key>
          <string>ThreadCount</string>
        </key>
        <value>
          <string>System.Int32:2</string>
        </value>
      </item>
      <item>
        <key>
          <string>RetryCount</string>
        </key>
        <value>
          <string>System.Int32:1</string>
        </value>
      </item>
      <item>
        <key>
          <string>UpdateOnlineDatabase</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>MinimizeToTray</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>CreateDatabaseBackups</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>OpenWebsiteOnDoubleClick</string>
        </key>
        <value>
          <string>System.Boolean:False</string>
        </value>
      </item>
      <item>
        <key>
          <string>ProxyPort</string>
        </key>
        <value>
          <string>AAEAAAD/////AQAAAAAAAAAEAQAAAA5TeXN0ZW0uRGVjaW1hbAQAAAAFZmxhZ3MCaGkCbG8DbWlkAAAAAAgICAgAAAAAAAAAALgiAAAAAAAACw==</string>
        </value>
      </item>
      <item>
        <key>
          <string>ProxyServer</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>ProxyUser</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>ProxyPassword</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>MainForm/Size</string>
        </key>
        <value>
          <string>System.Drawing.Size:1281,890</string>
        </value>
      </item>
      <item>
        <key>
          <string>MainForm/Location</string>
        </key>
        <value>
          <string>System.Drawing.Point:1,876</string>
        </value>
      </item>
      <item>
        <key>
          <string>MainForm/WindowState</string>
        </key>
        <value>
          <string>System.Int32:0</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Application:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Application:Width</string>
        </key>
        <value>
          <string>System.Int32:183</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Application:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:0</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Last updated:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Last updated:Width</string>
        </key>
        <value>
          <string>System.Int32:110</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Last updated:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:2</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Progress:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Progress:Width</string>
        </key>
        <value>
          <string>System.Int32:100</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Progress:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:4</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Target:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Target:Width</string>
        </key>
        <value>
          <string>System.Int32:159</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Target:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:5</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Category:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Category:Width</string>
        </key>
        <value>
          <string>System.Int32:80</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Category:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:6</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Status:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Status:Width</string>
        </key>
        <value>
          <string>System.Int32:52</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Status:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:7</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/LastSortColumn</string>
        </key>
        <value>
          <string>System.String:Application</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/LastSortOrder</string>
        </key>
        <value>
          <string>System.Int32:1</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Version:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Version:Width</string>
        </key>
        <value>
          <string>System.Int32:70</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Version:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:1</string>
        </value>
      </item>
      <item>
        <key>
          <string>Ketarin/ShowGroups</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>Ketarin/ShowStatusBar</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>Ketarin/ShowLog</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>Ketarin/AutoScroll</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>SetPlaceholderDialog/Size</string>
        </key>
        <value>
          <string>System.Drawing.Size:418,166</string>
        </value>
      </item>
      <item>
        <key>
          <string>SetPlaceholderDialog/Location</string>
        </key>
        <value>
          <string>System.Drawing.Point:1131,1028</string>
        </value>
      </item>
      <item>
        <key>
          <string>SetPlaceholderDialog/WindowState</string>
        </key>
        <value>
          <string>System.Int32:0</string>
        </value>
      </item>
      <item>
        <key>
          <string>EditVariablesDialog/Size</string>
        </key>
        <value>
          <string>System.Drawing.Size:1630,732</string>
        </value>
      </item>
      <item>
        <key>
          <string>EditVariablesDialog/Location</string>
        </key>
        <value>
          <string>System.Drawing.Point:-3,1012</string>
        </value>
      </item>
      <item>
        <key>
          <string>EditVariablesDialog/WindowState</string>
        </key>
        <value>
          <string>System.Int32:0</string>
        </value>
      </item>
      <item>
        <key>
          <string>ApplicationJobDialog/Size</string>
        </key>
        <value>
          <string>System.Drawing.Size:423,429</string>
        </value>
      </item>
      <item>
        <key>
          <string>ApplicationJobDialog/Location</string>
        </key>
        <value>
          <string>System.Drawing.Point:333,652</string>
        </value>
      </item>
      <item>
        <key>
          <string>ApplicationJobDialog/WindowState</string>
        </key>
        <value>
          <string>System.Int32:0</string>
        </value>
      </item>
      <item>
        <key>
          <string>LogDialog/Size</string>
        </key>
        <value>
          <string>System.Drawing.Size:1504,604</string>
        </value>
      </item>
      <item>
        <key>
          <string>LogDialog/Location</string>
        </key>
        <value>
          <string>System.Drawing.Point:0,5</string>
        </value>
      </item>
      <item>
        <key>
          <string>LogDialog/WindowState</string>
        </key>
        <value>
          <string>System.Int32:0</string>
        </value>
      </item>
      <item>
        <key>
          <string>ErrorsDialog/Size</string>
        </key>
        <value>
          <string>System.Drawing.Size:1096,373</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvErrors/Application:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvErrors/Application:Width</string>
        </key>
        <value>
          <string>System.Int32:98</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvErrors/Application:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:-1</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvErrors/Error:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvErrors/Error:Width</string>
        </key>
        <value>
          <string>System.Int32:960</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvErrors/Error:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:-1</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvErrors/LastSortColumn</string>
        </key>
        <value>
          <string>System.String:Error</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvErrors/LastSortOrder</string>
        </key>
        <value>
          <string>System.Int32:2</string>
        </value>
      </item>
      <item>
        <key>
          <string>ProgressDialog/Size</string>
        </key>
        <value>
          <string>System.Drawing.Size:292,98</string>
        </value>
      </item>
      <item>
        <key>
          <string>Hotkey: OpenWebsite</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>Hotkey: Edit</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>Hotkey: Update</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>Hotkey: ForceDownload</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>Hotkey: InstallSelected</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>Hotkey: OpenFile</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>Hotkey: OpenFolder</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>Hotkey: CheckUpdate</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>Hotkey: UpdateAndInstall</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>InstallingApplicationsDialog/Size</string>
        </key>
        <value>
          <string>System.Drawing.Size:406,250</string>
        </value>
      </item>
      <item>
        <key>
          <string>InstallingApplicationsDialog/Location</string>
        </key>
        <value>
          <string>System.Drawing.Point:164,724</string>
        </value>
      </item>
      <item>
        <key>
          <string>InstallingApplicationsDialog/WindowState</string>
        </key>
        <value>
          <string>System.Int32:0</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvLog/Time:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvLog/Time:Width</string>
        </key>
        <value>
          <string>System.Int32:55</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvLog/Time:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:-1</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvLog/Message:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvLog/Message:Width</string>
        </key>
        <value>
          <string>System.Int32:310</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvLog/Message:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:-1</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvLog/LastSortColumn</string>
        </key>
        <value>
          <string>System.String:Time</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvLog/LastSortOrder</string>
        </key>
        <value>
          <string>System.Int32:0</string>
        </value>
      </item>
      <item>
        <key>
          <string>InstallingApplicationsDialog/Expanded</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>DefaultCommand</string>
        </key>
        <value>
          <string>System.String:////////////////////////////////////////////////////////////////////////////////////////
/// version 6.5
/// 
/// FIX: do not re-push package if package already created
/// 

// REQUIRES:
// global vars: workdir=corresponds to download location of installer file
// app vars: nopush, checksum64file=corresponds to 64 bit install file
// file vars: same as specified by chocopkgup
string varCScript = app.Variables.ReplaceAllInString("{cscript}");
if ((varCScript == "1") || (varCScript == "2")) {
string varAppname = app.Variables.ReplaceAllInString("{appname}");
string varVersion = app.Variables.ReplaceAllInString("{version}");
string varChocoPkgOutput = app.Variables.ReplaceAllInString("{chocoPkgOutput}");
string varChecksum = app.Variables.ReplaceAllInString("{checksum}");
string varChecksumx64 = app.Variables.ReplaceAllInString("{checksumx64}");
string varChecksum64File = app.Variables.ReplaceAllInString("{checksum64file}");
string varChecksum64basefile = app.Variables.ReplaceAllInString("{checksum64file:basefile}");
string varChecksum64ext = app.Variables.ReplaceAllInString("{checksum64file:ext}");
string varWorkdir = app.Variables.ReplaceAllInString("{workdir}");
string saveFileName64 = String.Concat(varChecksum64basefile, ".", varChecksum64ext);
// equivalent to ketarin variable "{file}"
//string savePath = app.PreviousLocation;
string savePath = app.PreviousLocation;
string pkgPath = Path.Combine(varChocoPkgOutput, varAppname, varVersion);
string fileNameNuspec = String.Concat(varAppname, ".nuspec");
string fileUriNuspec = Path.Combine(pkgPath, fileNameNuspec);
string fileNameNupkg = String.Concat(varAppname, ".", varVersion, ".nupkg");
string fileUriNupkg = Path.Combine(pkgPath, fileNameNupkg);

// do not re-push package if package already created
DateTime today = DateTime.Today;
DateTime pkgCreateDate = File.GetCreationTime(pkgPath);
if (today &gt; pkgCreateDate) {
	return;
}

if (varChecksum == "{checksum}") {
  // calculate SHA1
  System.IO.FileStream fileSha1 = new System.IO.FileStream(savePath, System.IO.FileMode.Open);
  System.Security.Cryptography.SHA1 sha1 = new System.Security.Cryptography.SHA1CryptoServiceProvider();
  byte[] retValSha1 = sha1.ComputeHash(fileSha1);
  fileSha1.Close();

  // create a string
  System.Text.StringBuilder sbSha1 = new System.Text.StringBuilder();
  for (int i = 0; i &lt; retValSha1.Length; i++) {
    sbSha1.Append(retValSha1[i].ToString("x2"));
  }
     
  string replaceChecksum = sbSha1.ToString();
  List&lt;string&gt; fileList = new List&lt;string&gt;(Directory.GetFiles(pkgPath, "*.ps1", SearchOption.AllDirectories));
  string[] filesNuspec = Directory.GetFiles(pkgPath, "*.nuspec", SearchOption.AllDirectories);
  fileList.AddRange(filesNuspec);
  string[] files = fileList.ToArray();
  foreach (string file in files) {
    try {
      string contents = File.ReadAllText(file);
      contents = contents.Replace("{checksum}", replaceChecksum);
      // Make files writable
      // File.SetAttributes(file, FileAttributes.Normal);
      File.WriteAllText(file, contents);
    } catch (Exception ex) {
      Console.WriteLine(ex.Message);
    }
  }
}

// only get checksum if {checksum64file} exists and points to a downloadable file
if (varChecksumx64 == "{checksumx64}" &amp;&amp; varChecksum64File != "{checksum64file}") {
  string savePath64 = Path.Combine(varWorkdir, saveFileName64);
  System.Net.WebClient webClient = new System.Net.WebClient();
  webClient.DownloadFile(varChecksum64File, savePath64);

  // calculate SHA1
  System.IO.FileStream file64Sha1 = new System.IO.FileStream(savePath64, System.IO.FileMode.Open);
  System.Security.Cryptography.SHA1 sha164 = new System.Security.Cryptography.SHA1CryptoServiceProvider();
  byte[] retVal64Sha1 = sha164.ComputeHash(file64Sha1);
  file64Sha1.Close();

  // create a string
  System.Text.StringBuilder sb64Sha1 = new System.Text.StringBuilder();
  for (int i = 0; i &lt; retVal64Sha1.Length; i++) {
    sb64Sha1.Append(retVal64Sha1[i].ToString("x2"));
  }
     
  string replace64Checksum = sb64Sha1.ToString();
  List&lt;string&gt; fileList = new List&lt;string&gt;(Directory.GetFiles(pkgPath, "*.ps1", SearchOption.AllDirectories));
  string[] filesNuspec = Directory.GetFiles(pkgPath, "*.nuspec", SearchOption.AllDirectories);
  fileList.AddRange(filesNuspec);
  string[] files = fileList.ToArray();
  foreach (string file in files) {
    try {
      string contents = File.ReadAllText(file);
      contents = contents.Replace("{checksumx64}", replace64Checksum);
      File.WriteAllText(file, contents);
    } catch (Exception ex) {
      Console.WriteLine(ex.Message);
    }
  }
}

int checkBeta = varVersion.Split('-').Length;
if ( checkBeta == 2) {
  string strPre = varVersion.Split('-')[1];
  string strReplace = String.Concat(strPre, "&lt;/version&gt;");
   string strCheck = String.Concat(".", DateTime.Now.ToString("yyyyMMdd"), "&lt;/version&gt;");
   string[] fileNuspec = Directory.GetFiles(pkgPath, "*.nuspec", SearchOption.AllDirectories);
  foreach (string file in fileNuspec) {
    string contents = File.ReadAllText(file);
    contents = contents.Replace(strCheck, strReplace);
    File.WriteAllText(file, contents);
  }
}

// delete existing nupkg made by chocopkgup; we leverage chocopkgup to create the structure/files in destination  
System.Diagnostics.Process process1 = new System.Diagnostics.Process();
System.Diagnostics.ProcessStartInfo proc1 = new System.Diagnostics.ProcessStartInfo();
proc1.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
proc1.UseShellExecute = true;
proc1.WorkingDirectory = pkgPath;
proc1.FileName = "cmd.exe";
proc1.Arguments = "/c "+"del /f " + fileUriNupkg;
process1.StartInfo = proc1;
process1.Start();

// create a new nupkg
System.Diagnostics.Process process2 = new System.Diagnostics.Process();
System.Diagnostics.ProcessStartInfo proc2 = new System.Diagnostics.ProcessStartInfo();
proc2.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
proc2.UseShellExecute = true;
proc2.WorkingDirectory = pkgPath;
proc2.FileName = "cmd.exe";
proc2.Arguments = "/c "+"choco pack "+fileUriNuspec+" -d";
process2.StartInfo = proc2;
process2.Start();

// push the nupkg
if (varCScript == "2") {
  System.Diagnostics.Process process3 = new System.Diagnostics.Process();
  System.Diagnostics.ProcessStartInfo proc3 = new System.Diagnostics.ProcessStartInfo();
  proc3.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
  proc3.UseShellExecute = true;
  proc3.WorkingDirectory = pkgPath;
  proc3.FileName = "cmd.exe";
  // find nupkg in pkgPath
  string[] pushPkg = Directory.GetFiles(pkgPath, "*.nupkg", SearchOption.TopDirectoryOnly);
  foreach (String file in pushPkg) {
    proc3.Arguments = "/c "+"cpush " + file + " -d";
  }
  process3.StartInfo = proc3;
  System.Threading.Thread.Sleep(2000);
  process3.Start();
}
}</string>
        </value>
      </item>
      <item>
        <key>
          <string>DefaultCommandType</string>
        </key>
        <value>
          <string>System.String:CS</string>
        </value>
      </item>
      <item>
        <key>
          <string>PostUpdateCommand</string>
        </key>
        <value>
          <string>System.String:</string>
        </value>
      </item>
      <item>
        <key>
          <string>PostUpdateCommandType</string>
        </key>
        <value>
          <string>System.String:Batch</string>
        </value>
      </item>
      <item>
        <key>
          <string>DefaultApplication</string>
        </key>
        <value>
          <string>System.String:&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;Jobs&gt;
  &lt;ApplicationJob xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema"&gt;
    &lt;WebsiteUrl /&gt;
    &lt;UserAgent /&gt;
    &lt;UserNotes /&gt;
    &lt;LastFileSize&gt;0&lt;/LastFileSize&gt;
    &lt;LastFileDate xsi:nil="true" /&gt;
    &lt;IgnoreFileInformation&gt;false&lt;/IgnoreFileInformation&gt;
    &lt;DownloadBeta&gt;Default&lt;/DownloadBeta&gt;
    
    &lt;CheckForUpdatesOnly&gt;false&lt;/CheckForUpdatesOnly&gt;
    &lt;VariableChangeIndicator /&gt;
    &lt;CanBeShared&gt;true&lt;/CanBeShared&gt;
    &lt;ShareApplication&gt;false&lt;/ShareApplication&gt;
    &lt;ExclusiveDownload&gt;false&lt;/ExclusiveDownload&gt;
    &lt;HttpReferer /&gt;
    &lt;SetupInstructions /&gt;
    &lt;Variables&gt;
      &lt;item&gt;
        &lt;key&gt;
          &lt;string&gt;nopush&lt;/string&gt;
        &lt;/key&gt;
        &lt;value&gt;
          &lt;UrlVariable&gt;
            &lt;RegexRightToLeft&gt;false&lt;/RegexRightToLeft&gt;
            &lt;VariableType&gt;Textual&lt;/VariableType&gt;
            &lt;Regex /&gt;
            &lt;TextualContent&gt;--nopush&lt;/TextualContent&gt;
            &lt;Name&gt;nopush&lt;/Name&gt;
          &lt;/UrlVariable&gt;
        &lt;/value&gt;
      &lt;/item&gt;
      &lt;item&gt;
        &lt;key&gt;
          &lt;string&gt;version&lt;/string&gt;
        &lt;/key&gt;
        &lt;value&gt;
          &lt;UrlVariable&gt;
            &lt;RegexRightToLeft&gt;false&lt;/RegexRightToLeft&gt;
            &lt;VariableType&gt;RegularExpression&lt;/VariableType&gt;
            &lt;Regex&gt;Last program version.*?([\d\.]+)&lt;/Regex&gt;
            &lt;Url&gt;x&lt;/Url&gt;
            &lt;Name&gt;version&lt;/Name&gt;
          &lt;/UrlVariable&gt;
        &lt;/value&gt;
      &lt;/item&gt;
      &lt;item&gt;
        &lt;key&gt;
          &lt;string&gt;url&lt;/string&gt;
        &lt;/key&gt;
        &lt;value&gt;
          &lt;UrlVariable&gt;
            &lt;RegexRightToLeft&gt;false&lt;/RegexRightToLeft&gt;
            &lt;VariableType&gt;Textual&lt;/VariableType&gt;
            &lt;Regex /&gt;
            &lt;TextualContent&gt;{getUrl}&lt;/TextualContent&gt;
            &lt;Name&gt;url&lt;/Name&gt;
          &lt;/UrlVariable&gt;
        &lt;/value&gt;
      &lt;/item&gt;
      &lt;item&gt;
        &lt;key&gt;
          &lt;string&gt;url64&lt;/string&gt;
        &lt;/key&gt;
        &lt;value&gt;
          &lt;UrlVariable&gt;
            &lt;RegexRightToLeft&gt;false&lt;/RegexRightToLeft&gt;
            &lt;VariableType&gt;Textual&lt;/VariableType&gt;
            &lt;Regex /&gt;
            &lt;TextualContent&gt;{getUrl64}&lt;/TextualContent&gt;
            &lt;Name&gt;url64&lt;/Name&gt;
          &lt;/UrlVariable&gt;
        &lt;/value&gt;
      &lt;/item&gt;
      &lt;item&gt;
        &lt;key&gt;
          &lt;string&gt;getUrl&lt;/string&gt;
        &lt;/key&gt;
        &lt;value&gt;
          &lt;UrlVariable&gt;
            &lt;RegexRightToLeft&gt;false&lt;/RegexRightToLeft&gt;
            &lt;VariableType&gt;RegularExpression&lt;/VariableType&gt;
            &lt;Regex&gt;[^ "'&amp;lt;&amp;gt;\*]+\.exe&lt;/Regex&gt;
            &lt;Url&gt;x&lt;/Url&gt;
            &lt;Name&gt;getUrl&lt;/Name&gt;
          &lt;/UrlVariable&gt;
        &lt;/value&gt;
      &lt;/item&gt;
      &lt;item&gt;
        &lt;key&gt;
          &lt;string&gt;getUrl64&lt;/string&gt;
        &lt;/key&gt;
        &lt;value&gt;
          &lt;UrlVariable&gt;
            &lt;RegexRightToLeft&gt;false&lt;/RegexRightToLeft&gt;
            &lt;VariableType&gt;RegularExpression&lt;/VariableType&gt;
            &lt;Regex&gt;[^ "'&amp;lt;&amp;gt;\*]+\.exe&lt;/Regex&gt;
            &lt;Url&gt;x&lt;/Url&gt;
            &lt;Name&gt;getUrl64&lt;/Name&gt;
          &lt;/UrlVariable&gt;
        &lt;/value&gt;
      &lt;/item&gt;
      &lt;item&gt;
        &lt;key&gt;
          &lt;string&gt;checksum&lt;/string&gt;
        &lt;/key&gt;
        &lt;value&gt;
          &lt;UrlVariable&gt;
            &lt;RegexRightToLeft&gt;false&lt;/RegexRightToLeft&gt;
            &lt;VariableType&gt;RegularExpression&lt;/VariableType&gt;
            &lt;Regex&gt;[A-Fa-f0-9]{32}&lt;/Regex&gt;
            &lt;Url&gt;md5&lt;/Url&gt;
            &lt;TextualContent&gt;{checksum}&lt;/TextualContent&gt;
            &lt;Name&gt;checksum&lt;/Name&gt;
          &lt;/UrlVariable&gt;
        &lt;/value&gt;
      &lt;/item&gt;
      &lt;item&gt;
        &lt;key&gt;
          &lt;string&gt;checksumx64&lt;/string&gt;
        &lt;/key&gt;
        &lt;value&gt;
          &lt;UrlVariable&gt;
            &lt;RegexRightToLeft&gt;false&lt;/RegexRightToLeft&gt;
            &lt;VariableType&gt;RegularExpression&lt;/VariableType&gt;
            &lt;Regex&gt;(?&amp;lt;=ResponseUri: )[^\r\n]+&lt;/Regex&gt;
            &lt;Url&gt;{url64}&lt;/Url&gt;
            &lt;TextualContent&gt;{checksum}&lt;/TextualContent&gt;
            &lt;Name&gt;checksumx64&lt;/Name&gt;
          &lt;/UrlVariable&gt;
        &lt;/value&gt;
      &lt;/item&gt;
      &lt;item&gt;
        &lt;key&gt;
          &lt;string&gt;checksum64file&lt;/string&gt;
        &lt;/key&gt;
        &lt;value&gt;
          &lt;UrlVariable&gt;
            &lt;RegexRightToLeft&gt;false&lt;/RegexRightToLeft&gt;
            &lt;VariableType&gt;Textual&lt;/VariableType&gt;
            &lt;Regex /&gt;
            &lt;TextualContent&gt;{url64}&lt;/TextualContent&gt;
            &lt;Name&gt;checksum64file&lt;/Name&gt;
          &lt;/UrlVariable&gt;
        &lt;/value&gt;
      &lt;/item&gt;
      &lt;item&gt;
        &lt;key&gt;
          &lt;string&gt;cscript&lt;/string&gt;
        &lt;/key&gt;
        &lt;value&gt;
          &lt;UrlVariable&gt;
            &lt;RegexRightToLeft&gt;false&lt;/RegexRightToLeft&gt;
            &lt;VariableType&gt;Textual&lt;/VariableType&gt;
            &lt;Regex /&gt;
            &lt;TextualContent&gt;0&lt;/TextualContent&gt;
            &lt;Name&gt;cscript&lt;/Name&gt;
          &lt;/UrlVariable&gt;
        &lt;/value&gt;
      &lt;/item&gt;
    &lt;/Variables&gt;
    &lt;ExecuteCommand /&gt;
    &lt;ExecutePreCommand /&gt;
    &lt;ExecuteCommandType&gt;Batch&lt;/ExecuteCommandType&gt;
    &lt;ExecutePreCommandType&gt;Batch&lt;/ExecutePreCommandType&gt;
    &lt;Category /&gt;
    &lt;SourceType&gt;FixedUrl&lt;/SourceType&gt;
    
    &lt;DeletePreviousFile&gt;false&lt;/DeletePreviousFile&gt;
    &lt;Enabled&gt;true&lt;/Enabled&gt;
    &lt;FileHippoId /&gt;
    
    &lt;TargetPath&gt;{workdir}\&lt;/TargetPath&gt;
    &lt;FixedDownloadUrl&gt;{url}&lt;/FixedDownloadUrl&gt;
    &lt;Name&gt;x&lt;/Name&gt;
  &lt;/ApplicationJob&gt;
&lt;/Jobs&gt;</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/x:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/x:Width</string>
        </key>
        <value>
          <string>System.Int32:89</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/x:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:-1</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Filesize:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Filesize:Width</string>
        </key>
        <value>
          <string>System.Int32:60</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/Filesize:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:8</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/url:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/url:Width</string>
        </key>
        <value>
          <string>System.Int32:147</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/url:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:-1</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/host:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/host:Width</string>
        </key>
        <value>
          <string>System.Int32:183</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/host:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:9</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/packageGuid:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/packageGuid:Width</string>
        </key>
        <value>
          <string>System.Int32:115</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/packageGuid:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:10</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/fileDate:Visibility</string>
        </key>
        <value>
          <string>System.Boolean:True</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/fileDate:Width</string>
        </key>
        <value>
          <string>System.Int32:114</string>
        </value>
      </item>
      <item>
        <key>
          <string>olvJobs/fileDate:LastDisplayIndex</string>
        </key>
        <value>
          <string>System.Int32:3</string>
        </value>
      </item>
    </dictionary>
  </Settings>
  <GlobalVariables>
    <Variable Name="7z" Content="7z.exe" />
    <Variable Name="curl" Content="pycurl/7.18.2" />
    <Variable Name="workdir" Content="F:\exe" />
    <Variable Name="chocoPkgOutput" Content="C:\dev\chocolatey\chocolatey-packages\automatic\_output" />
    <Variable Name="ie32" Content="Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C)" />
    <Variable Name="ie64" Content="Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; Win64; x64; Trident/4.0; .NET CLR 2.0.50727; SLCC2; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; Media Center PC 5.0; SLCC1; Tablet PC 2.0; .NET4.0C)" />
    <Variable Name="firefox" Content="Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US; rv:1.9.2.10) Gecko/20100914 Firefox/3.6.10" />
    <Variable Name="opera" Content="Opera/9.80 (Windows NT 6.1; U; en) Presto/2.6.30 Version/10.62" />
    <Variable Name="chrome" Content="Mozilla/5.0 (Windows; U; Windows NT 6.1; en-US) AppleWebKit/534.3 (KHTML, like Gecko) Chrome/6.0.472.63 Safari/534.3" />
    <Variable Name="wget" Content="wget/1.9+cvs-stable+(red+hat+modified)" />
  </GlobalVariables>
  <CodeSnippets>
    <Snippet Guid="7158800B-A188-4CAB-927C-31AA36FDD049" Name="chocopkgup" Type="1">chocopkgup {nopush} --packagename={appname} --version={version} --pg="{packageGuid}" --url="{preupdate-url}" --urlx64="{url64}" --packagepath="{file}" --checksum="{checksum}" --c64="{checksumx64}" --debug</Snippet>
    <Snippet Guid="BB8AF683-DA06-4C20-8434-9F854C46B961" Name="cs" Type="0">////////////////////////////////////////////////////////////////////////////////////////
/// version 6.5
/// 
/// FIX: do not re-push package if package already created
/// 

// REQUIRES:
// global vars: workdir=corresponds to download location of installer file
// app vars: nopush, checksum64file=corresponds to 64 bit install file
// file vars: same as specified by chocopkgup
string varCScript = app.Variables.ReplaceAllInString("{cscript}");
if ((varCScript == "1") || (varCScript == "2")) {
string varAppname = app.Variables.ReplaceAllInString("{appname}");
string varVersion = app.Variables.ReplaceAllInString("{version}");
string varChocoPkgOutput = app.Variables.ReplaceAllInString("{chocoPkgOutput}");
string varChecksum = app.Variables.ReplaceAllInString("{checksum}");
string varChecksumx64 = app.Variables.ReplaceAllInString("{checksumx64}");
string varChecksum64File = app.Variables.ReplaceAllInString("{checksum64file}");
string varChecksum64basefile = app.Variables.ReplaceAllInString("{checksum64file:basefile}");
string varChecksum64ext = app.Variables.ReplaceAllInString("{checksum64file:ext}");
string varWorkdir = app.Variables.ReplaceAllInString("{workdir}");
string saveFileName64 = String.Concat(varChecksum64basefile, ".", varChecksum64ext);
// equivalent to ketarin variable "{file}"
//string savePath = app.PreviousLocation;
string savePath = app.PreviousLocation;
string pkgPath = Path.Combine(varChocoPkgOutput, varAppname, varVersion);
string fileNameNuspec = String.Concat(varAppname, ".nuspec");
string fileUriNuspec = Path.Combine(pkgPath, fileNameNuspec);
string fileNameNupkg = String.Concat(varAppname, ".", varVersion, ".nupkg");
string fileUriNupkg = Path.Combine(pkgPath, fileNameNupkg);

// do not re-push package if package already created
DateTime today = DateTime.Today;
DateTime pkgCreateDate = File.GetCreationTime(pkgPath);
if (today &gt; pkgCreateDate) {
	return;
}

if (varChecksum == "{checksum}") {
  // calculate SHA1
  System.IO.FileStream fileSha1 = new System.IO.FileStream(savePath, System.IO.FileMode.Open);
  System.Security.Cryptography.SHA1 sha1 = new System.Security.Cryptography.SHA1CryptoServiceProvider();
  byte[] retValSha1 = sha1.ComputeHash(fileSha1);
  fileSha1.Close();

  // create a string
  System.Text.StringBuilder sbSha1 = new System.Text.StringBuilder();
  for (int i = 0; i &lt; retValSha1.Length; i++) {
    sbSha1.Append(retValSha1[i].ToString("x2"));
  }
     
  string replaceChecksum = sbSha1.ToString();
  List&lt;string&gt; fileList = new List&lt;string&gt;(Directory.GetFiles(pkgPath, "*.ps1", SearchOption.AllDirectories));
  string[] filesNuspec = Directory.GetFiles(pkgPath, "*.nuspec", SearchOption.AllDirectories);
  fileList.AddRange(filesNuspec);
  string[] files = fileList.ToArray();
  foreach (string file in files) {
    try {
      string contents = File.ReadAllText(file);
      contents = contents.Replace("{checksum}", replaceChecksum);
      // Make files writable
      // File.SetAttributes(file, FileAttributes.Normal);
      File.WriteAllText(file, contents);
    } catch (Exception ex) {
      Console.WriteLine(ex.Message);
    }
  }
}

// only get checksum if {checksum64file} exists and points to a downloadable file
if (varChecksumx64 == "{checksumx64}" &amp;&amp; varChecksum64File != "{checksum64file}") {
  string savePath64 = Path.Combine(varWorkdir, saveFileName64);
  System.Net.WebClient webClient = new System.Net.WebClient();
  webClient.DownloadFile(varChecksum64File, savePath64);

  // calculate SHA1
  System.IO.FileStream file64Sha1 = new System.IO.FileStream(savePath64, System.IO.FileMode.Open);
  System.Security.Cryptography.SHA1 sha164 = new System.Security.Cryptography.SHA1CryptoServiceProvider();
  byte[] retVal64Sha1 = sha164.ComputeHash(file64Sha1);
  file64Sha1.Close();

  // create a string
  System.Text.StringBuilder sb64Sha1 = new System.Text.StringBuilder();
  for (int i = 0; i &lt; retVal64Sha1.Length; i++) {
    sb64Sha1.Append(retVal64Sha1[i].ToString("x2"));
  }
     
  string replace64Checksum = sb64Sha1.ToString();
  List&lt;string&gt; fileList = new List&lt;string&gt;(Directory.GetFiles(pkgPath, "*.ps1", SearchOption.AllDirectories));
  string[] filesNuspec = Directory.GetFiles(pkgPath, "*.nuspec", SearchOption.AllDirectories);
  fileList.AddRange(filesNuspec);
  string[] files = fileList.ToArray();
  foreach (string file in files) {
    try {
      string contents = File.ReadAllText(file);
      contents = contents.Replace("{checksumx64}", replace64Checksum);
      File.WriteAllText(file, contents);
    } catch (Exception ex) {
      Console.WriteLine(ex.Message);
    }
  }
}

int checkBeta = varVersion.Split('-').Length;
if ( checkBeta == 2) {
  string strPre = varVersion.Split('-')[1];
  string strReplace = String.Concat(strPre, "&lt;/version&gt;");
   string strCheck = String.Concat(".", DateTime.Now.ToString("yyyyMMdd"), "&lt;/version&gt;");
   string[] fileNuspec = Directory.GetFiles(pkgPath, "*.nuspec", SearchOption.AllDirectories);
  foreach (string file in fileNuspec) {
    string contents = File.ReadAllText(file);
    contents = contents.Replace(strCheck, strReplace);
    File.WriteAllText(file, contents);
  }
}

// delete existing nupkg made by chocopkgup; we leverage chocopkgup to create the structure/files in destination  
System.Diagnostics.Process process1 = new System.Diagnostics.Process();
System.Diagnostics.ProcessStartInfo proc1 = new System.Diagnostics.ProcessStartInfo();
proc1.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
proc1.UseShellExecute = true;
proc1.WorkingDirectory = pkgPath;
proc1.FileName = "cmd.exe";
proc1.Arguments = "/c "+"del /f " + fileUriNupkg;
process1.StartInfo = proc1;
process1.Start();

// create a new nupkg
System.Diagnostics.Process process2 = new System.Diagnostics.Process();
System.Diagnostics.ProcessStartInfo proc2 = new System.Diagnostics.ProcessStartInfo();
proc2.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
proc2.UseShellExecute = true;
proc2.WorkingDirectory = pkgPath;
proc2.FileName = "cmd.exe";
proc2.Arguments = "/c "+"choco pack "+fileUriNuspec+" -d";
process2.StartInfo = proc2;
process2.Start();

// push the nupkg
if (varCScript == "2") {
  System.Diagnostics.Process process3 = new System.Diagnostics.Process();
  System.Diagnostics.ProcessStartInfo proc3 = new System.Diagnostics.ProcessStartInfo();
  proc3.WindowStyle = System.Diagnostics.ProcessWindowStyle.Hidden;
  proc3.UseShellExecute = true;
  proc3.WorkingDirectory = pkgPath;
  proc3.FileName = "cmd.exe";
  // find nupkg in pkgPath
  string[] pushPkg = Directory.GetFiles(pkgPath, "*.nupkg", SearchOption.TopDirectoryOnly);
  foreach (String file in pushPkg) {
    proc3.Arguments = "/c "+"cpush " + file + " -d";
  }
  process3.StartInfo = proc3;
  System.Threading.Thread.Sleep(2000);
  process3.Start();
}
}</Snippet>
  </CodeSnippets>
  <SetupLists />
</Ketarin>